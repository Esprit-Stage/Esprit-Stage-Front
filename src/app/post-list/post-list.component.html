<h2 class="text-center mb-4">ğŸ“š Liste des posts</h2>

<div class="container">

  <!-- ğŸ” Barre de recherche -->
  <div class="input-group mb-4">
    <input
      type="text"
      class="form-control"
      placeholder="Rechercher par titre ou contenu..."
      [(ngModel)]="searchQuery"
      (input)="searchPosts()"
    />
    <button class="btn btn-outline-secondary" (click)="searchPosts()">
      ğŸ” Rechercher
    </button>
  </div>

  <!-- ğŸ§¾ Grille de posts -->
  <div class="row g-4">
    <div class="col-12 col-md-6 col-lg-4" *ngFor="let post of filteredPosts">
      <div class="card h-100 shadow-sm border-light">
        <div class="card-body d-flex flex-column">

          <!-- ğŸ–¼ï¸ Image -->
          <div class="mb-3 text-center">
            <img
              [src]="post.imageUrl || 'assets/images/default.jpg'"
              alt="Image"
              class="img-fluid rounded"
              style="max-height: 200px; object-fit: cover;"
            />
          </div>

          <!-- ğŸ“ Titre -->
          <h5 class="text-primary fw-bold">{{ post.titre }}</h5>

          <!-- ğŸ“ƒ Contenu tronquÃ© -->
          <p class="mb-2" [ngStyle]="{ 'max-height': isExpanded(post.id) ? 'none' : '100px', 'overflow': 'hidden' }">
            <strong>Contenu :</strong> {{ post.content }}
          </p>

          <button class="btn btn-link p-0 mb-2" (click)="toggleExpand(post.id)">
            {{ isExpanded(post.id) ? 'ğŸ”¼ Voir moins' : 'ğŸ”½ Voir plus' }}
          </button>

          <!-- ğŸ”— Lien externe -->
          <p *ngIf="post.link">
            <strong>Lien :</strong>
            <a [href]="post.link" target="_blank">{{ post.link }}</a>
          </p>

          <!-- ğŸ‘¤ Auteur -->
          <p>
            <strong>Auteur :</strong>
            <span *ngIf="post.etudiant">{{ post.etudiant.name }} (Ã‰tudiant)</span>
            <span *ngIf="post.enseignant">{{ post.enseignant.name }} (Enseignant)</span>
          </p>

          <!-- âœ… Approbation -->
          <p *ngIf="post.isApproved" class="text-success fw-bold">âœ… ApprouvÃ©</p>

          <!-- Ã‰toiles -->
          <div *ngIf="post.rating >= 0" class="mb-3">
            <label class="rating">
              <span 
                *ngFor="let star of [1, 2, 3, 4, 5]" 
                [class.filled]="star <= post.rating"
                (click)="updatePostRating(post.id, star)" 
                class="star"
              >
                &#9733;
              </span>
            </label>
          </div>

          <!-- ğŸ‘ğŸ‘ Likes / Dislikes -->
          <div class="d-flex gap-2 mb-3">
            <button class="btn btn-outline-success btn-sm flex-fill" (click)="likePost(post.id)">
              ğŸ‘ J'aime ({{ post.likeCount }})
            </button>
            <button class="btn btn-outline-danger btn-sm flex-fill" (click)="dislikePost(post.id)">
              ğŸ‘ Je n'aime pas ({{ post.dislikeCount }})
            </button>
          </div>

          <!-- ğŸ› ï¸ Actions -->
          <div class="d-flex flex-wrap gap-2 mb-2">
            <button (click)="deletePost(post.id)" class="btn btn-danger btn-sm flex-grow-1">
              ğŸ—‘ï¸ Supprimer
            </button>
            <button [routerLink]="['/edit', post.id]" class="btn btn-warning btn-sm flex-grow-1">
              âœï¸ Modifier
            </button>
            <button (click)="viewDetails(post.id)" class="btn btn-info btn-sm flex-grow-1">
              ğŸ‘ï¸ DÃ©tails
            </button>
          </div>

          <!-- ğŸ’¬ Commentaires -->
          <div class="mt-2">
            <app-commentaire [postId]="post.id"></app-commentaire>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- â• Ajouter un post -->
  <div class="text-center mt-4">
    <button routerLink="/add-post" class="btn btn-primary">
      â• Ajouter un nouveau post
    </button>
  </div>
  <button routerLink="/admin/dashboard" class="go-dashboard-btn">
    ğŸ› ï¸ Aller au Dashboard Admin
  </button>
  

</div>
